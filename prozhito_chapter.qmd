---
format: 
  docx:
    prefer-html: true
bibliography: bibliography.bib
editor: source
---


```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(tidyverse)
library(lingglosses)
options("lingglosses.italic_transliteration" = FALSE)
# convert bibliography from .tsv to .bib
library(bib2df)
read_tsv("bibliography.tsv") %>% 
  df2bib(file = "bibliography.bib")
```

# Тематическое моделирование на корпусе текстов Центра «Прожито»

## Введение

«Прожито» – это проект, который занимается сбором и публикацией текстовдневников (личных документов) под руководством М. Мельниченко начиная с 2015 года. В 2019 году был создан цифровой архив Центра «Прожито». Большая работа по оцифровке и разметке выполнена волонтерами. Первым проектом «Прожито» стал корпус личных дневников — электронная библиотека датированных личных записей, которая позволяет пользователям работать не только с конкретными дневниками, но и всей совокупностью текстов эпохи: получать выборки по датам, полу, возрасту, месту ведения дневника и т. д. С 2019 года корпус пополняется также мемуарными текстами. Корпус мультиязычный и включает в себя разделы на русском, украинском, белорусском и казахском языках. На зиму 2022 года аннотировано более 9 тыс. авторов, загружены дневники 2 727 из них, около 700 дневников — первопубликации проекта. Общий объем корпуса — более 626 тыс. подневных записей XVIII–XX веков. Сама идея сбора дневников – следствие антропоцентричного поворота в исторической науке и смежна такому направлению как устная история (oral history) – практике сбора и изучения воспоминаний очевидцев исторических событий. В Европе есть сходные по идеологии проекты, например, [Oral History Society](https://www.ohs.org.uk/) в Великобритании; [Bureau of Military History](https://www.militaryarchives.ie/collections/online-collections/bureau-of-military-history-1913-1921/) в Ирландии; [Post Bellum](https://www.postbellum.cz/) в Чехии.

## Структура корпуса

Корпус текстов Центра «Прожито» хранится в базе данных, состоящей из таблиц, из которых в настоящей работе использовались в первую очередь четыре: persons, diary,diaries\_languages и notes. Они содержат информацию о самих записях, дневниках, в которых тексты находятся, и об авторах этих дневников. Помимо текстов записей нам часто доступна информация о том, когда запись была сделана, на каком языке, а также ФИО, годы жизни и род деятельности авторах (структуру этой части БД см. @fig-image1). 

```{r}
#| label: fig-image1
#| fig-cap: "Структура БД, хранящей корпус дневников «Прожито»"

knitr::include_graphics("images/image1.png")
```

Корпус содержит дневниковые записи с 1581 по 2018 годы, однако они неравномерно распределены по этому отрезку времени. Наибольшая концентрация текстов приходится на XX век (см. @fig-image2). Соответственно, наиболее информативное получение знаний из корпуса текстов машинными методами будет приходиться именно на этот период.

```{r}
#| label: fig-image2
#| fig-cap: "Распределение записей в корпусе «Прожито» по годам"

knitr::include_graphics("images/image2.png")
```

## Используемый метод

Для того, чтобы проанализировать эти тексты был выбран метод тематического моделирования. Тематическое моделирование – это способ построения модели коллекции текстовых документов, которая определяет, к каким темам относится каждый из документов. Тема в этом случае представляет собой список слов, которые, с одной стороны, часто встречаются в конкретном тексте, и, с другой стороны, характерны для определенного контекста и не характерны для других.

В программировании есть несколько алгоритмов, используемых для тематического моделирования, например, LSA,pLSA, LDA. Алгоритм LSA (латентно-семантический анализ) представляет тексты в виде матрицы, которая отражает, как часто каждое слово встречается в каждом из документов, для этого используется показатель tf-idf. Этот показатель маркирует значимость слова для темы: если слово часто встречается в каком-либо из документов, а в остальных документах встречается редко, то этот значение показателя растет. Далее матрица упорядочивается, и алгоритм на основании упорядоченной матрицы выделяет тематические кластеры.

Алгоритм LDA (латентное размещение Дирихле) построен на основе распределения вероятностей Дирихле. LDA представляет собой трехуровневую иерархическую Байесовскую модель, которая предсказывает, какими именно могут быть распределения вероятностей встретить тему в документе или слово в теме, если известно, каким в теории может быть это распределение. В настоящем исследовании для тематического моделирования текстов использовалась библиотека gensim для языка программирования python, в нее встроен алгоритм LDA.

## Описание работы с библиотекой genism

Для того, чтобы начать работу с библиотекой, нужен датасет с текстами в табличном формате. Мы выгружали из базы данных интересующие нас подкорпуса текстов в формате csv, а дальше считывали их в датафрейм с помощью библиотеки pandas. Все тексты, находящиеся в датафрейме, необходимо токенизировать, то есть разбить на слова, а также очистить от пунктуации и стоп-слов. Стоп-слова – это частые слова, которые встречаются почти во всех текстах и не несут содержательной информации о нем, поэтому их вместе со знаками пунктуации лучше всего удалить. [Список стоп-слов](https://raw.githubusercontent.com/dhhse/dh2020/master/data/stop_ru.txt) мы брали из открытого репозитория магистерской программы по Digital Humanitites НИУ ВШЭ. Для токенизации текстов использовалась библиотека nltk. После токенизации каждый из текстов представлен в виде списка слов. На этом этапе производилась дополнительная очистка данных от текстов, состоящих только из одного слова, так как, для тематического моделирования нужны данные о совместной встречаемости нескольких слов. Затем каждый из оставшихся текстов мы лемматизировали, то есть приводили все слова в нем к начальной форме, для этого была использована библиотека pymorphy2. После того, как все тексты подкорпуса представлены в виде списков, содержащих только значимые слова в начальной форме, переходим к тематическому моделированию.

Библиотека genism принимает на вход лемматизированные тексты и создает из них словарь для тематического моделирования. После создания словаря необходимо отфильтровать те слова, которые встречаются в слишком большом количестве текстов, и те, которые встречаются слишком редко. Для этого использовался метод filter\_extremes, который принимает в себя аргументы no\_above (только слова, которые встречаются не более чем в указанной доле текстов) и no\_below (слова, которые встречаются не менее чем в указанном количестве текстов). Для no\_above мы выставляли значение 0.1, а для no\_below – 40. После удаления лишних слов словарь ужимали в размерах, убрав пропуски с помощью метода compactify. Дальше подкорпус преобразовывался в «мешок слов» - упрощенное представление текста без учета грамматики и порядка слов, но с сохранением информации об их количестве. После этого уже непосредственно использовалась функция gensim.models.LdaMulticoreдля проведения тематического моделирования. В этой функции можно задать параметры num\_topics (число тем, которые необходимо выделить) и passes (количество «обходов», которые будет делать алгоритм - чем больше, тем точнее и медленнее будет создаваться модель). Так как дневниковые записи – это чаще всего довольно короткие тексты (средняя длина текстов варьируется от 50 до 70 слов), мы приняли решение выделять по 5 тем на каждые 15000 записей. Так, например, на подкорпус из 19803 записей выделялось 6 тем, а на подкорпус из 36467 записей – 11 тем. Количество обходов всегда равнялось 20.

В результате проведения тематического моделирования модель выводит список из кортежей, в каждом из которых содержится информация об одной теме – слова этой темы и вес каждого из слов для темы (пример см. @fig-image3).

```{r}
#| label: fig-image3
#| fig-cap: "Пример выдачи результатов тематического моделирования на материале записей, сделанных в 1891 – 1900 гг."

knitr::include_graphics("images/image3.png")
```

## Данные для тематического моделирования

Как уже было отмечено, наибольшая концентрация текстов в корпусе приходится на период с 1891 по 2010 год – 402150 записей. Поэтому в первую очередь мы решили проверить, какие именно темы выделяются по отдельности в каждом из десятилетий этого периода (о том, как число записей распределяется по десятилетиям см. @tbl-example1 и см. @fig-image4). Стоит сразу отметить, что наибольшая концентрация текстов в корпусе приходится на сороковые годы XX века. По-видимому, одним из ключевых интересов «Прожито» было оцифровать свидетельства о Великой Отечественной войне. Мы заранее предполагаем, что тема войны будет регулярно возникать в результатах тематического моделирования на разных подкорпусах. При описании наших данных мы также будет частично отталкиваться от военных лет, как от важной вехи XX века, затронувшей все пласты населения. Тематическое моделирование на текстах, взятых по десятилетиям, может позволить нам понять, какие события окружающей действительности были значимыми в каждом отрезке времени, а также с помощью каких слов и реалий люди чаще всего описывали важные событияэтого времени, например, революцию, репрессии, войну, перестройку, распад СССР.

|     Период написания записей    |     Число текстов    |
|---------------------------------|----------------------|
|     1891-1900                   |     22992            |
|     1901-1910                   |     30970            |
|     1911-1920                   |     48961            |
|     1921-1930                   |     38691            |
|     1931-1940                   |     36079            |
|     1941-1950                   |     80726            |
|     1951-1960                   |     26763            |
|     1961-1970                   |     30643            |
|     1971-1980                   |     26553            |
|     1981-1990                   |     28889            |
|     1991-2000                   |     19502            |
|     2001-2010                   |     11381            |

Распределение записей в корпусе с 1891 по 2010 гг {#tbl-example1}

```{r}
#| label: fig-image4
#| fig-cap: "Распределение записей в корпусе с 1891 по 2010 гг."

knitr::include_graphics("images/image4.png")
```

Такой подход к данным был вдохновлен работой по восстановлению мнемонического образа десятилетий двадцатого века на русскоязычном материале. А.А. Бонч-Осмоловская [@bonch2018: 	115-146] провела сравнительный анализ частотности сочетаний названий десятилетий с прилагательными на материале выборки из Национального корпуса языка для того, чтобы увидеть, какие значимые периоды XX века существуют в коллективной памяти и какие ассоциативные ряды с ними связаны. Автор выделяет шесть семантических классов прилагательных, которые употребляются в связке с названием десятилетия: оценка (напр., голодные, лучезарные); эмфаза (напр., бурные, незабвенные); отсылка к реалиям (напр., стиляжные, фарцовочные); отсылка к событиям (напр., военные, застойные); отсылка к локусу (напр., московские, ленинградские); дистанция (напр., далекие, недавние). Прилагательные оценки также подразделяются на имеющие позитивную и негативную окраску. Так пятидесятые и шестидесятые годы резко выделяются среди прочих десятилетий тем, что позитивно окрашенные прилагательные встречаются с ними чаще негативных. Наибольшее количество разнообразных прилагательных, описывающих реалии десятилетия, встречается с двадцатыми и пятидесятыми годами. Можно проверить, будут ли справедливы такие закономерности для корпуса дневников.

Отдельный интерес представляет то, как отличаются темы в записях женщин и мужчин. Соотношение таких записей в период с 1891 по 2010 год неравномерно: 321207 «мужская запись» и 80933 «женская», но объем текстов в обоих случаях достаточен для работы модели (см. @fig-image5). С помощью анализа этих подкорпусов мы можем понять, есть ли существенные отличия в том, о чем писали люди разного гендера в один и тот же период времени.

```{r}
#| label: fig-image5
#| fig-cap: "Распределение записей мужчин и женщин в корпусе с 1891 по 2010 гг."

knitr::include_graphics("images/image5.png")
```

Так как более чем для половины авторов (2493 из 4328 авторов в корпусе) нам доступна информация о годах жизни, мы также можем разделить наш корпус на подкорпусы в зависимости от поколения, к которому автор относился (см. @tbl-example2 и см. @fig-image6). Мы выделили четыре поколения людей, живших в течение XX века: люди 1891–1917 гг. рождения – те, кто родился до революции и участвовал в Великой Отечественной войне; люди 1918–1945 гг. рождения (так называемые «шестидесятники») – они родились уже после революции, часть из них также прошла войну; люди 1946–1964 гг. рождения – послевоенное поколение, так называемые «беби-бумеры» и люди 1965–1980 гг. рождения – «поколение X». На этом материале будет интересно посмотреть не на отличия в реалиях, содержащихся в дневниках людей разных поколений, а на то, есть ли различия в чувствах и ценностях, о которых пишут в дневниках представители разных поколений. Возможно, с помощью тематического моделирования на материале дневниковых записей можно составить некоторый «психологический портрет» поколения?

|     Название                                                 |     Период написания записей    |     Число текстов    |
|--------------------------------------------------------------|---------------------------------|----------------------|
|     тексты людей 1891-1917 гг   рождения                     |     1903-1995                   |     120062           |
|     тексты людей 1918-1945 гг   рождения (шестидесятники)    |     1930-2014                   |     89122            |
|     тексты людей 1946-1964 гг   рождения (беби-бумеры)       |     1953-2018                   |     19855            |
|     тексты людей 1965-1980 гг   рождения                     |     1980-2014                   |     4530             |

Распределение записей людей разных годов рождения в корпусе {#tbl-example2}

```{r}
#| label: fig-image6
#| fig-cap: "Распределение записей людей разных годов рождения в корпусе"

knitr::include_graphics("images/image6.png")
```

Последняя категория подкорпусов, составленных для настоящей работы, содержит тексты, собранные в зависимости от возраста, в котором автор вел дневник (см. @tbl-example3 и см. @fig-image7). Мы выбрали 5 категорий возраста, условно обозначенные так: детство (автору до 16 лет на момент записи); молодость (автору от 17 до 30 лет на момент записи); зрелость (автору от 31 до 45 лет на момент записи); зрелость (автору от 46 до 60 лет на момент записи) и старость (автор старше 60 лет на момент записи). На основании такого анализа можно получить сведения о том, о каких вещах чаще всего писали люди разного возраста в XX веке и какие отличия можно наблюдать в том, о чем пишут люди разного возраста.

|     Название                                                   |     Период написания записей    |     Число текстов    |
|----------------------------------------------------------------|---------------------------------|----------------------|
|     записи подростков (до 16 лет на момент записи)             |     1903-2001                   |     13869            |
|     записи молодых людей (от 17 до 30 лет на момент записи)    |     1908-2006                   |     66818            |
|     записи людей от 31 до 45 лет на момент записи              |     1922-2014                   |     69782            |
|     записи людей от 46 до 60 лет на момент записи              |     1937-2017                   |     47215            |
|     записи людей старше 60 лет на момент записи                |     1951-2018                   |     31114            |

Распределение записей людей разных возрастов в корпусе {#tbl-example3}

```{r}
#| label: fig-image7
#| fig-cap: "Распределение записей людей разных возрастов в корпусе"

knitr::include_graphics("images/image7.png")
```

## Тематическое моделирование на подкорпусах, разбитых по десятилетиям

Как уже было описано выше, записи, сделанные в период с 1891 по 2010 год, были разбиты нами на 12 подкорпусов по 10 лет каждый и проанализированы в отдельности. Так как объем записей в каждой из десятилетий разный, в каждом из случаев мы выделяли разное количество тем. В списке ниже указаны количество тем для каждого периода и номер рисунка, соответствующий периоду:

- 1891-1900 – 7 тем (см. @fig-image8);
- 1901-1910 – 7 тем (см. @fig-image9);
- 1911-1920 – 16 тем (см. @fig-image10 и см. @fig-image11);
- 1921-1930 – 10 тем (см. @fig-image12);
- 1931-1940 – 11 тем (см. @fig-image13);
- 1951-1960 – 7 тем (см. @fig-image14);
- 1961-1970 – 10 тем (см. @fig-image15);
- 1971-1980 – 7 тем (см. @fig-image16);
- 1981-1990 – 7 тем (см. @fig-image17);
- 1991-2000– 6 тем (см. @fig-image18);
- 2001-2010– 5 тем (см. @fig-image19).

В рисунках, отображающих результаты тематического моделирования для десятилетий каждому слову соответствует свой бар, длина которого зависит от веса слова в теме. Слова, выделенные в рамках одной темы, выделены одинаковым цветом. Все результаты тематического моделирования были разделены на несколько ключевых так или иначе проявляющихся в большинстве периодов:

1. Война
2. Религия
3. Обучение
4. Власть
5. Еда
6. Мысль
7. Семья
8. Дорога
9. Искусство

То, какие именно слова характеризуют тему в каждом конкретном случае и какие возникают пересечения между этими девятью основными темами, отображает восприятие десятилетия очевидцами событий и реалии десятилетия.

Так, например, тема еды в период с 1891 по 1910 годы представлена словами «завтрак», «обед», «чай» и глаголами «обедать» и «завтракать» и переплетена со словами темы «семья», а начиная с 1911 года тема еды включает в себя такие слова как «очередь», «хлеб» и обозначения денег, а слова, обозначающие прием пищи исчезают вовсе.

Тема религии в период с 1891 по 1900 год объединена с темой обучения: в одном кластере находятся такие слова как «священник», «книга» и «школа». С 1900 по 1920 годы религия объединена с семьей – там, где есть слова «служба», «священник», «патриарх», также встречаются слова «мама», «отец», «жена». После 1920 года церковные реалии почти исчезают, зато появляются слова «молитва» и «бог» в связке со словами «тюрьма», «война», «могила», «смерть».

```{r}
#| label: fig-image8
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1891 – 1900 гг."

knitr::include_graphics("images/image8.png")
```

```{r}
#| label: fig-image9
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1901 – 1911 гг."

knitr::include_graphics("images/image9.png")
```

```{r}
#| label: fig-image10
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1911 – 1920 гг. Часть 1."

knitr::include_graphics("images/image10.png")
```

```{r}
#| label: fig-image11
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1911 – 1920 гг. Часть 2."

knitr::include_graphics("images/image11.png")
```

```{r}
#| label: fig-image12
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1921 – 1930 гг."

knitr::include_graphics("images/image12.png")
```

```{r}
#| label: fig-image13
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1931 – 1940 гг."

knitr::include_graphics("images/image13.png")
```

```{r}
#| label: fig-image14
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1951 – 1960 гг."

knitr::include_graphics("images/image14.png")
```

```{r}
#| label: fig-image15
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1961 – 1970 гг."

knitr::include_graphics("images/image15.png")
```

```{r}
#| label: fig-image16
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1971 – 1980 гг."

knitr::include_graphics("images/image16.png")
```

```{r}
#| label: fig-image17
#| fig-cap: "Тематическое моделирование на записях, сделанных в 1981 – 1990 гг."

knitr::include_graphics("images/image17.png")
```

## Заключение

В настоящем исследовании мы описали структуру данных дневниковых записей, содержащихся в корпусе «Прожито» и подкорпусы, которые можно выделить в этих данных для проведения тематического моделирования. Также мы описали принцип работы алгоритмов тематического моделирования и то, каким образом его можно провести с помощью библиотеки gensim. На данный момент тематическое моделирование проведено на записях, сделанных в период с 1891 по 2010 год, разбитых по десятилетиям.

В дальнейшем планируется провести тематическое моделирование на материале подкорпусов, разбитых по возрасту автора, поколению автора и гендеру автора и проанализировать получившиеся данные. С помощью такого анализа можно выявить семантический ореол разных поколений и людей разных возрастов, проживавших в XX веке и писавших на русском языке в дополнение к уже выявленному семантическому ореолу различных десятилетий XX века.

